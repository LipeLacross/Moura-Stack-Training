<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}Moura Stack Dashboard{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="/static/moura-logo.ico" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2563eb',
            bgDark: '#ffffff', // fundo branco
            card: '#f8fafc',
            border: '#e2e8f0',
            accent: '#2563eb',
            kpi: '#64748b',
            kpiValue: '#0f172a',
          }
        }
      }
    }
  </script>
</head>
<body class="bg-bgDark text-kpiValue min-h-screen">
  <header class="bg-primary/10 px-8 py-4 flex justify-between items-center shadow">
    <div class="flex items-center gap-2">
      <h1 class="text-xl font-bold text-primary">ðŸ”‹ Moura Stack</h1>
    </div>
    <nav class="flex gap-4 text-accent">
      <a href="/" class="hover:underline font-semibold">Dashboard</a>
      <span class="text-gray-400">|</span>
      <a href="/docs" target="_blank" class="hover:underline font-semibold">Docs API</a>
    </nav>
  </header>
  <main class="container mx-auto px-4 py-8">
    {% block content %}{% endblock %}
  </main>
  <footer class="mt-16 py-6 text-xs text-gray-500 text-center border-t border-border">
    Moura Stack â€¢ FastAPI â€¢ {{ year }}
  </footer>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const applyBtn = document.getElementById('apply-filters');
      if (applyBtn) {
        applyBtn.addEventListener('click', async function() {
          const startDate = document.getElementById('start-date').value;
          const endDate = document.getElementById('end-date').value;
          const product = document.getElementById('product-filter').value;
          let url = `/metrics/sales?`;
          if (startDate) url += `start_date=${startDate}&`;
          if (endDate) url += `end_date=${endDate}&`;
          if (product) url += `product=${encodeURIComponent(product)}&`;
          try {
            const res = await fetch(url);
            const data = await res.json();
            // Atualiza tabela de vendas
            const tbody = document.getElementById('sales-table-body');
            if (tbody && Array.isArray(data.sales)) {
              tbody.innerHTML = data.sales.map(sale => `
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${sale.date}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${sale.product}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${sale.quantity}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">R$ ${parseFloat(sale.unit_price).toFixed(2)}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">R$ ${parseFloat(sale.total).toFixed(2)}</td>
                </tr>
              `).join('');
            }
            // Atualiza KPIs
            if (data.summary) {
              document.getElementById('revenue-kpi').querySelector('.text-primary').textContent = `R$ ${parseFloat(data.summary.total_revenue).toFixed(2)}`;
              document.getElementById('quantity-kpi').querySelector('.text-primary').textContent = data.summary.total_quantity;
              document.getElementById('avg-ticket-kpi').querySelector('.text-primary').textContent = `R$ ${parseFloat(data.summary.avg_ticket).toFixed(2)}`;
            }
            // TODO: Atualizar grÃ¡ficos interativos se necessÃ¡rio
          } catch (err) {
            alert('Erro ao aplicar filtros.');
          }
        });
      }
    });
  </script>
</body>
</html>
